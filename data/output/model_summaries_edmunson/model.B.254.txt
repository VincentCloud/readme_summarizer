easyflash 1、介绍（english） easyflash是一款开源的轻量级嵌入式flash存储器库，方便开发者更加轻松的实现基于flash存储器的常见应用开发。非常适合智能家居、可穿戴、工控、医疗等需要断电存储功能的产品，资源占用极低，支持各种 mcu 片上存储器。该库主要包括 三大实用功能 ： env 快速保存产品参数，支持 写平衡（磨损平衡） 及 掉电保护 功能 easyflash不仅能够实现对产品的 设定参数 或 运行日志 等信息的掉电保存功能，还封装了简洁的 增加、删除、修改及查询 方法， 降低了开发者对产品参数的处理难度，也保证了产品在后期升级时拥有更好的扩展性。让flash变为nosql（非关系型数据库）模型的小型键值（keyvalue）存储数据库。 iap 在线升级再也不是难事儿 该库封装了iapinapplication programming功能常用的接口，支持crc32校验，同时支持bootloader及application的升级。 log 无需文件系统，日志可直接存储在flash上 非常适合应用在小型的不带文件系统的产品中，方便开发人员快速定位、查找系统发生崩溃或死机的原因。同时配合easylogger我开源的超轻量级、高性能c日志库，它提供与easyflash的无缝接口一起使用，轻松实现c日志的flash存储功能。 1.1、v4.0 ng 模式 自 2019 年春节后，easyflash 经过 4 年多的迭代，结合众多开发者的需求及建议，终于发布了 v4.0 版本，该版本中的 env 功能被命名为 ng next generation 模式，这是一个完全重构的新版本，具有以下新特性： 更小的资源占用，内存占用 几乎为 0 ；（v4.0 以前版本会使用额外的 ram 空间进行缓存） env 的值类型支持 任意类型 、任意长度，相当于直接 memcpy 变量至 flash ；（v4.0 之前只支持存储字符串） env 操作效率比以前的模式高，充分利用剩余空闲区域，擦除次数及操作时间显著降低； 原生支持 磨损平衡、掉电保护功能 （v4.0 之前需要占用额外的 flash 扇区）； env 支持 增量升级 ，固件升级后 env 也支持升级； 支持大数据存储模式，长度无限制，数据可在多个 flash 扇区上顺序存储。像脚本程序、音频等占用 flash 超过 1 个扇区的资源也都可以存入 env（即将在 v4.1 支持）； 支持 数据加密 ，提升存储的安全性，物联网时代的必备功能（即将在 v4.2 支持）； 支持 数据压缩 ，减低 flash 占用（即将在 v4.3 支持）； v4.0 设计及内部原理，v4.0 迁移指南等更多内容请继续阅读下面的 文档章节 1.2、资源占用 1.3、支持平台 目前已移植硬件平台有 与 系列的片内flash，spi flash，这些也是笔者产品使用的平台。其余平台的移植难度不大，在项目的设计之初就有考虑针对所有平台的适配性问题（64位除外），所以对所有移植接口都有做预留。移植只需修改 一个文件，实现里面的擦、写、读及打印功能即可。 欢迎大家 fork and pull requestgithuboschinacoding 。如果觉得这个开源项目很赞，可以点击项目主页 右上角的 star，同时把它推荐给更多有需要的朋友。 2、流程 2.1、env：环境变量（kv数据库） 下图为通过控制台（终端）来调用环境变量的常用接口，演示了以下过程，这些接口都支持被应用层直接调用。 1、创建“温度”的环境变量，名为 ，并且赋值为 ； 2、保存“温度”到flash中并重启（v4.0 版本的每个操作完自动保存，无需额外保存）； 3、检查“温度”是否被成功保存； 4、修改“温度”值为 并保存、重启； 5、检查“温度”是否被成功修改； 6、删除“温度”的环境变量。 2.2、iap：在线升级 下图演示了通过控制台来进行iap升级软件的过程，使用的是库中自带的iap功能接口，演示采用的是串口ymodem协议的方式。你还也可以实现通过can、485、以太网等总线，来实现远程网络更新。 2.3、log：日志存储 下图过程为通过控制台输出日志，并将输出的日志存储到flash中。重启再读取上次保存的日志，最后清空flash日志。 3、文档 api 文档： 移植文档： v4.0 迁移指南：docszhv4migrate.md v4.0 env 功能设计与实现：docszhdesign.md 务必保证在 阅读文档 后再移植使用。 4、支持 如果 easyflash 解决了你的问题，不妨请我 喝杯咖啡 5、许可 采用 mit 开源协议，细节请阅读项目中的 license 文件内容。 1 introduction easyflash is an open source lightweight embedded flash memory library.